

    <dom-element id="esri-marker-content">

        <template >
            <content></content>
        </template>

        <script>


            Polymer({

                is : "esri-marker-content",

                attached : function() {

                    console.log("This marker has a marker content");
                    var parent = Polymer.dom(this).parentNode;
                    var target = Polymer.dom(this).node;


                    // ASYNC REQUIRED! -- https://github.com/Polymer/polymer/issues/1699
                    this.async(function() {
                    window.addEventListener('WebComponentsReady', function(e) {


                    var map = Polymer.dom(parent).parentNode.map;
                    var markerid = parent.markerid;
                    console.log(map, markerid)

                    new MutationObserver(updateMarkerContent).observe(
                        target,
                        { childList: true, subtree: true }
                    );

                    function updateMarkerContent(mutations) {

                        var graphicLayerIds = map.graphicsLayerIds;
                        var len = graphicLayerIds.length;
                        for (var i = 0; i < len; i++) {
                           var markerLayer = map.getLayer(graphicLayerIds[i]);
                           //clear this Layer
                           if (markerLayer.hasOwnProperty("markerId") && markerLayer.markerId == markerid) {
                               var title = mutations[0].nextSibling.textContent
                               markerLayer.graphics[0].infoTemplate.setContent(title);
                               // TODO sort hiding/reshowing of infoWindow

                           }
                       }

                    }

                    });
                    });

                    },

                    detached :  function() {


                    }

            });  // End of Polymer


        </script>

    </dom-element>
